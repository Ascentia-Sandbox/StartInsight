# ============================================
# StartInsight Backend - Environment Variables
# ============================================
# Copy this file to .env and fill in your actual values
# NEVER commit the .env file to version control
#
# CLOUD-FIRST SETUP:
# This project uses cloud services by default (no local database/Redis):
# 1. Supabase Cloud PostgreSQL (Database + Auth)
# 2. Upstash Redis (Task Queue + Cache)
# 3. Railway/Vercel (Deployment)
#
# See README.md for detailed setup instructions

# ============================================
# Environment
# ============================================
ENVIRONMENT=development
LOG_LEVEL=info

# ============================================
# Database (Supabase Cloud PostgreSQL)
# ============================================
# Get your connection string from: Supabase Dashboard > Project Settings > Database
# Format: postgresql+asyncpg://postgres.[PROJECT_REF]:[PASSWORD]@aws-0-[REGION].pooler.supabase.com:6543/postgres?pgbouncer=true
# Example: postgresql+asyncpg://postgres.abcdefghijklmnop:your-password@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres?pgbouncer=true
DATABASE_URL=postgresql+asyncpg://postgres.[PROJECT_REF]:[YOUR_PASSWORD]@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres?pgbouncer=true

# ============================================
# Redis (Task Queue & Cache)
# ============================================
# Get your Redis URL from: Upstash Console > Your Redis > Details > REST API
# Format: redis://default:[PASSWORD]@[ENDPOINT].upstash.io:6379
# Example: redis://default:AbCdEf123456@us1-example-12345.upstash.io:6379
REDIS_URL=redis://default:[YOUR_PASSWORD]@[YOUR_ENDPOINT].upstash.io:6379

# ============================================
# AI & LLM APIs
# ============================================
# Google Gemini (Primary - Gemini 2.0 Flash)
GOOGLE_API_KEY=your_google_api_key_here

# Anthropic (Fallback LLM)
ANTHROPIC_API_KEY=your_anthropic_api_key_here

# OpenAI (Fallback LLM)
OPENAI_API_KEY=your_openai_api_key_here

# ============================================
# Web Scraping APIs
# ============================================
# PMF Optimization: Use Crawl4AI ($0 cost) instead of Firecrawl ($149/mo)
USE_CRAWL4AI=true

# Firecrawl (Web to Markdown) - Keep as fallback during transition
FIRECRAWL_API_KEY=your_firecrawl_api_key_here

# Reddit API (PRAW)
REDDIT_CLIENT_ID=your_reddit_client_id_here
REDDIT_CLIENT_SECRET=your_reddit_client_secret_here
REDDIT_USER_AGENT=StartInsight Bot v1.0 (by /u/your_username)
REDDIT_USERNAME=your_username

# ============================================
# API Configuration
# ============================================
# FastAPI
API_HOST=0.0.0.0
API_PORT=8000
API_RELOAD=false

# CORS (Allowed Origins - comma separated)
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# ============================================
# Task Scheduling (Arq)
# ============================================
# Scraping interval (in hours) - PMF: Reduced from 6 to 12 to save resources
SCRAPE_INTERVAL_HOURS=12

# Batch size for analysis tasks - PMF: Increased from 10 to 50 for batching
ANALYSIS_BATCH_SIZE=50

# ============================================
# PMF Optimization Flags
# ============================================
# Disable daily digest emails to stay in Resend Free tier (3K emails/month)
ENABLE_DAILY_DIGEST=false

# ============================================
# Supabase Authentication & Database
# ============================================
# Get these from: Supabase Dashboard > Project Settings > API
# URL Format: https://[PROJECT_REF].supabase.co
SUPABASE_URL=https://[PROJECT_REF].supabase.co
SUPABASE_ANON_KEY=your_supabase_anon_key_here
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key_here

# JWT Secret (from Supabase Dashboard > Project Settings > API > JWT Settings > JWT Secret)
# CRITICAL: Must be at least 32 characters. Generate with: openssl rand -hex 32
# This is the SAME secret from your Supabase project settings
JWT_SECRET=your_jwt_secret_from_supabase_min_32_chars
# JWT Algorithm: ES256 is primary (auto-detected from Supabase JWKS at /auth/v1/.well-known/jwks.json).
# HS256 is fallback only for legacy tokens.
JWT_ALGORITHM=HS256

# ============================================
# Phase 6.1: Stripe Payments
# ============================================
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key_here
STRIPE_PUBLISHABLE_KEY=pk_test_your_stripe_publishable_key_here
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret_here
STRIPE_PRICE_STARTER=price_starter_id_here
STRIPE_PRICE_PRO=price_pro_id_here

# ============================================
# Phase 6.2: Email (Resend)
# ============================================
RESEND_API_KEY=re_your_resend_api_key_here
EMAIL_FROM_ADDRESS=noreply@startinsight.ai
EMAIL_FROM_NAME=StartInsight

# ============================================
# Phase 6.3: Rate Limiting
# ============================================
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_PER_HOUR=1000

# ============================================
# Phase 7.1: Twitter/X Integration
# ============================================
TWITTER_API_KEY=your_twitter_api_key_here
TWITTER_API_SECRET=your_twitter_api_secret_here
TWITTER_ACCESS_TOKEN=your_twitter_access_token_here
TWITTER_ACCESS_SECRET=your_twitter_access_secret_here
TWITTER_BEARER_TOKEN=your_twitter_bearer_token_here

# ============================================
# Phase 7.2: Public API
# ============================================
PUBLIC_API_RATE_LIMIT=100

# ============================================
# Phase 7.3: Multi-tenancy
# ============================================
DEFAULT_TENANT_ID=default
ENABLE_MULTI_TENANCY=false

# ============================================
# Production Infrastructure
# ============================================
# Sentry Error Tracking (Required in production)
# Get your DSN from: sentry.io > Your Project > Settings > Client Keys (DSN)
SENTRY_DSN=https://your_sentry_dsn_here@o123456.ingest.sentry.io/123456

# Refresh Token Secret (Required in production)
# CRITICAL: Must be at least 32 characters. Generate with: openssl rand -hex 32
# Different from JWT_SECRET for security
REFRESH_TOKEN_SECRET=your_refresh_token_secret_min_32_chars_here

# Slack Webhook URL (Optional - for CRITICAL alerts)
# Get your webhook from: Slack > Your Workspace > Apps > Incoming Webhooks
# Format: https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXX
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# ============================================
# LLM Configuration
# ============================================
DEFAULT_LLM_MODEL=google-gla:gemini-2.0-flash
LLM_CALL_TIMEOUT=120

# ============================================
# Database Connection Pool (Supabase Pro: 200 connections)
# ============================================
# Supabase Pro is the ONLY database -- no local PostgreSQL needed
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=30
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_SSL=true

# ============================================
# Redis Extended Config
# ============================================
# Set to true in production for SSL connections
REDIS_SSL=false
REDIS_SOCKET_CONNECT_TIMEOUT=5
REDIS_SOCKET_TIMEOUT=5

# ============================================
# Sentry Monitoring (PMF: Use Free tier - 5K events/month)
# ============================================
# Downgrade to Free tier: sentry.io > Settings > Subscription > Downgrade
# Reduce sample rate to stay within limits
SENTRY_TRACES_SAMPLE_RATE=0.01  # Reduced from 0.1 for PMF (save quota)
SENTRY_PROFILES_SAMPLE_RATE=0.01  # Reduced from 0.1 for PMF (save quota)

# ============================================
# Worker (Arq)
# ============================================
WORKER_MAX_JOBS=10
WORKER_JOB_TIMEOUT=600

# ============================================
# Scraper Defaults
# ============================================
REDDIT_SUBREDDITS=startups,SaaS
REDDIT_POST_LIMIT=25
PRODUCT_HUNT_DAYS_BACK=1
PRODUCT_HUNT_LIMIT=10
TRENDS_TIMEFRAME=now 7-d
TRENDS_GEO=US

# ============================================
# Middleware & Security
# ============================================
MAX_REQUEST_SIZE=1000000
SSE_MAX_DURATION=3600
JWKS_FETCH_TIMEOUT=10.0
JWKS_CACHE_TTL=3600
CORS_ALLOWED_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Authorization,Content-Type,X-Request-ID,X-API-Key,Accept,Accept-Language
CSP_CONNECT_SRC='self' https://generativelanguage.googleapis.com https://*.supabase.co
CORS_ALLOWED_PRODUCTION_ORIGINS=https://startinsight.app,https://www.startinsight.app,https://app.startinsight.app

# ============================================
# Application
# ============================================
APP_VERSION=0.1.0
TENANT_BASE_DOMAIN=startinsight.ai
DEFAULT_MAX_USERS=10
DEFAULT_MAX_TEAMS=3
DEFAULT_MAX_API_KEYS=2
