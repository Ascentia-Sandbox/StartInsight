# ============================================
# StartInsight Backend - PRODUCTION Environment
# ============================================
# Copy to .env on your Railway production deployment
# NEVER commit actual .env files to version control
#
# COST: ~$30/mo total (Supabase Pro $25 + Gemini ~$5)
#
# WARNING: The production config validator (config.py) will CRASH the app
# if any variable marked [REQUIRED] below is missing or invalid.
# This is intentional — fail fast, not fail silently.

# ============================================
# Environment
# ============================================
ENVIRONMENT=production
LOG_LEVEL=warning

# ============================================
# Database (Supabase Pro — $25/mo, ap-southeast-2 Sydney)
# ============================================
# [REQUIRED] Connection string from Supabase Dashboard > Project Settings > Database
DATABASE_URL=postgresql+asyncpg://postgres.[PROJECT_REF]:[PASSWORD]@aws-0-ap-southeast-2.pooler.supabase.com:5432/postgres

DB_POOL_SIZE=10
DB_MAX_OVERFLOW=15
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_SSL=true

# ============================================
# Supabase Auth [REQUIRED in production]
# ============================================
# [REQUIRED] Supabase Dashboard > Project Settings > API
SUPABASE_URL=https://[PROJECT_REF].supabase.co
SUPABASE_ANON_KEY=your_supabase_anon_key
# [REQUIRED] Service role key — never expose to frontend
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key

# [REQUIRED] JWT secret — min 32 chars
# From Supabase Dashboard > Project Settings > API > JWT Settings
JWT_SECRET=your_jwt_secret_from_supabase_min_32_chars
JWT_ALGORITHM=HS256

# ============================================
# Redis (Upstash Free tier — $0)
# ============================================
# Upstash requires TLS — URL must be rediss:// (double-s)
REDIS_URL=rediss://default:[PASSWORD]@[ENDPOINT].upstash.io:6379
REDIS_SSL=true
REDIS_SOCKET_CONNECT_TIMEOUT=5
REDIS_SOCKET_TIMEOUT=5

# ============================================
# AI & LLM (Gemini 2.0 Flash — ~$5/mo)
# ============================================
GOOGLE_API_KEY=your_google_api_key
DEFAULT_LLM_MODEL=google-gla:gemini-2.0-flash
LLM_CALL_TIMEOUT=120

# ============================================
# API Configuration [REQUIRED values enforced]
# ============================================
API_HOST=0.0.0.0
API_PORT=8000
# [REQUIRED] Must be false in production
API_RELOAD=false

# [REQUIRED] Must be https:// — no localhost allowed
APP_URL=https://api.startinsight.co

# [REQUIRED] Must be HTTPS, must be in CORS_ALLOWED_PRODUCTION_ORIGINS whitelist
CORS_ORIGINS=https://startinsight.co,https://www.startinsight.co
CORS_ALLOWED_PRODUCTION_ORIGINS=https://startinsight.co,https://www.startinsight.co

# ============================================
# Error Tracking [REQUIRED in production]
# ============================================
# [REQUIRED] Get DSN from sentry.io > Project > Settings > Client Keys
SENTRY_DSN=https://your_sentry_dsn@o123456.ingest.sentry.io/123456
SENTRY_TRACES_SAMPLE_RATE=0.05
SENTRY_PROFILES_SAMPLE_RATE=0.01

# ============================================
# Security [REQUIRED in production]
# ============================================
# [REQUIRED] Generate with: openssl rand -hex 32
# Must be different from JWT_SECRET
REFRESH_TOKEN_SECRET=your_refresh_token_secret_min_32_chars

# Rate Limiting
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_PER_HOUR=1000

# Middleware
MAX_REQUEST_SIZE=1000000
SSE_MAX_DURATION=3600
JWKS_FETCH_TIMEOUT=10.0
JWKS_CACHE_TTL=3600
CORS_ALLOWED_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Authorization,Content-Type,X-Request-ID,X-API-Key,Accept,Accept-Language
CSP_CONNECT_SRC='self' https://generativelanguage.googleapis.com https://*.supabase.co

# ============================================
# Web Scraping (Free APIs)
# ============================================
USE_CRAWL4AI=true
REDDIT_CLIENT_ID=your_reddit_client_id
REDDIT_CLIENT_SECRET=your_reddit_client_secret
REDDIT_USER_AGENT=StartInsight Bot v1.0 (by /u/your_username)
REDDIT_USERNAME=your_username

# ============================================
# Stripe Payments (switch to live keys when ready)
# ============================================
STRIPE_SECRET_KEY=sk_live_your_stripe_secret_key
STRIPE_PUBLISHABLE_KEY=pk_live_your_stripe_publishable_key
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret
STRIPE_PRICE_STARTER=price_starter_id
STRIPE_PRICE_PRO=price_pro_id

# ============================================
# Email (Resend Free tier — $0, 3K emails/mo)
# ============================================
RESEND_API_KEY=re_your_resend_api_key
EMAIL_FROM_ADDRESS=noreply@startinsight.co
EMAIL_FROM_NAME=StartInsight
ENABLE_DAILY_DIGEST=false

# ============================================
# Worker (Arq)
# ============================================
WORKER_MAX_JOBS=10
WORKER_JOB_TIMEOUT=600
SCRAPE_INTERVAL_HOURS=12
ANALYSIS_BATCH_SIZE=50

# ============================================
# Scraper Defaults
# ============================================
REDDIT_SUBREDDITS=startups,SaaS
REDDIT_POST_LIMIT=25
PRODUCT_HUNT_DAYS_BACK=1
PRODUCT_HUNT_LIMIT=10
TRENDS_TIMEFRAME=now 7-d
TRENDS_GEO=US

# ============================================
# Optional Services
# ============================================
# Slack alerts for CRITICAL errors (recommended)
# SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# Twitter/X API (optional)
# TWITTER_BEARER_TOKEN=

# Multi-tenancy (disabled for MVP)
ENABLE_MULTI_TENANCY=false
DEFAULT_TENANT_ID=default

# Application
APP_VERSION=0.1.0
